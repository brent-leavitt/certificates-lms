<?php// Course Functions// // Functions and blocks of code that are specific to course templates. $section_list = new Section_list();//toggle between section pages and assignment/content pages.$child_of = ( $course_type == 'section' )? get_the_ID() : $post->post_parent; $list_args = array(	'title_li'=>"",	'post_type'=>"course", 	'depth'=>"1", 	'child_of'=> $child_of,	'sort_column'=>"menu_order",	'walker' => $section_list);//NB COURSE NAV BAR//used on the course assignment and content templates. function nb_course_nav_bar(){		global $post; 		$ancs =  array_reverse( get_post_ancestors( $post->ID ) ); //returns an array. Closest at top, farthest is at the bottom. 	/* echo "Post Ancestors:";	print_pre( $ancs );	$ancs_num = sizeof($ancs);	$course_pos = intval($ancs_num - 1);	$cert_title = 	$course_title = nb_breadcrumb_link( $ancs[$course_pos] );	$unit_title = nb_breadcrumb_link( $ancs[0] ); */	$course_type = intval( get_post_meta($post->ID, 'course_type', true) );		echo '<div class="course-nav-title">Course Navigation:</div>';		if( $course_type !== 2 ){ //2 = section, show only next and previous tabs if in content or assignments. 		$prev_course = nb_content_siblings("prev");		$next_course = nb_content_siblings("next");		echo '<ul class="course-nav-pag">';								if( !empty( $prev_course ) )			echo "<li class='prev'><a href='$prev_course' >&lsaquo; Prev</a></li>"; 		if( !empty( $next_course ) )			echo "<li class='next'><a href='$next_course'>Next &rsaquo;</a></li>"; 					echo "</ul>";	}			echo "<div class='course-nav-unit'><a href='".home_url()."'>Home</a> / <a href='".home_url('/manuals/')."' >Manuals</a>";		foreach( $ancs as $anc_id){		$bread_title = nb_breadcrumb_link( $anc_id );		echo " / $bread_title";	}	/* echo ( !empty( $course_title ) )? "/ $course_title" : '' ; 	echo ( strcmp($course_title, $unit_title) !== 0 )? " / $unit_title" : ''; 	//don't show if same as first link.  */	echo "</div>";}//NB BREADCRUMB LINKfunction nb_breadcrumb_link( $postID ){		return ( !empty( $postID ) )? '<a href="'.get_permalink( $postID ).'" >'.get_the_title( $postID ).'</a>' : NULL ;	}//NB CONTENT SIBLINGS//used for finding next-door neighbors in content.function nb_content_siblings($link) {    global $post;		//$parent = intval( $post->post_parent );		$page_args = array(		'child_of' => intval( $post->post_parent ),		'sort_column' => 'menu_order',		'post_type' => 'course'	);		$pages = get_pages( $page_args );	if ($pages) {		$pageids = array();		foreach ($pages as $page) {			$pageids[]= $page->ID;		}	}	    foreach ($pageids as $key => $sibling){        if ($post->ID == $sibling){            $curID = $key;        }    } 		$closest = array();		if( $curID > 0 )		$closest['prev'] = get_permalink($pageids[$curID-1]);			if( $curID < ( sizeof($pageids) - 1 ) )		$closest['next'] = get_permalink($pageids[$curID+1]);	    //if ($link == 'prev' || $link == 'next') { return $closest[$link]; } else { return NULL; } 		return ($link == 'prev' || $link == 'next')? $closest[$link] : NULL ; 	}function nb_course_post_actions(){		global $current_user;	$sid = $current_user->ID;	update_user_meta( $sid, 'course_bookmarks', get_the_ID() );	}?>